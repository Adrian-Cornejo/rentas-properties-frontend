<div class="locations-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1 class="title">Ubicaciones</h1>
      <p class="subtitle">Gestiona las colonias y zonas de tus propiedades</p>
    </div>
    <button
      class="btn btn-primary"
      (click)="startCreating()"
      *ngIf="!isCreating()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12h14"/>
      </svg>
      Nueva Ubicación
    </button>
  </div>

  <!-- Search Bar -->
  <div class="search-section" *ngIf="!isCreating()">
    <div class="search-box">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
      <input
        type="text"
        placeholder="Buscar por nombre, ciudad o estado..."
        (input)="onSearchChange($event)">
    </div>
  </div>

  <!-- Create/Edit Form -->
  <div class="form-section" *ngIf="isCreating()">
    <div class="form-header">
      <h2>{{ isEditing() ? 'Editar Ubicación' : 'Nueva Ubicación' }}</h2>
      <button class="btn-close" (click)="cancelEditing()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <form [formGroup]="locationForm" (ngSubmit)="saveLocation()">
      <!-- Basic Information -->
      <div class="form-section-group">
        <h3 class="section-title">Información Básica</h3>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="name">Nombre de la Ubicación *</label>
            <input
              id="name"
              type="text"
              formControlName="name"
              placeholder="Ej: Colonia El Calvario">
            <span class="error-message" *ngIf="locationForm.get('name')?.invalid && locationForm.get('name')?.touched">
              El nombre es requerido
            </span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="address">Dirección</label>
            <input
              id="address"
              type="text"
              formControlName="address"
              placeholder="Dirección general del área">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="city">Ciudad</label>
            <input
              id="city"
              type="text"
              formControlName="city"
              placeholder="Ej: Querétaro">
          </div>

          <div class="form-group">
            <label for="state">Estado</label>
            <input
              id="state"
              type="text"
              formControlName="state"
              placeholder="Ej: Querétaro">
          </div>

          <div class="form-group">
            <label for="postalCode">Código Postal</label>
            <input
              id="postalCode"
              type="text"
              formControlName="postalCode"
              placeholder="00000"
              maxlength="5">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="description">Descripción</label>
            <textarea
              id="description"
              formControlName="description"
              rows="4"
              placeholder="Información adicional sobre la ubicación..."></textarea>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancelEditing()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="locationForm.invalid || isSaving()">
          {{ isSaving() ? 'Guardando...' : (isEditing() ? 'Actualizar' : 'Crear') }}
        </button>
      </div>
    </form>
  </div>

  <!-- Locations List -->
  <div class="locations-list" *ngIf="!isCreating()">
    <div *ngIf="isLoading()" class="skeleton-list">
      <p-skeleton height="100px" *ngFor="let i of [1,2,3,4,5]"></p-skeleton>
    </div>

    <div *ngIf="!isLoading() && filteredLocations().length === 0" class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
        <circle cx="12" cy="10" r="3"/>
      </svg>
      <p>No se encontraron ubicaciones</p>
    </div>

    <div class="locations-grid" *ngIf="!isLoading() && filteredLocations().length > 0">
      <div class="location-card" *ngFor="let location of filteredLocations()">
        <div class="location-header">
          <div class="location-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
          </div>
          <h3 class="location-name">{{ location.name }}</h3>
        </div>

        <div class="location-body">
          <div class="location-info" *ngIf="location.address">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            <span>{{ location.address }}</span>
          </div>

          <div class="location-details">
            <div class="detail-item" *ngIf="location.city">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 21h18M5 21V7l8-4v18M19 21V11l-6-4"/>
              </svg>
              <span>{{ location.city }}</span>
            </div>
            <div class="detail-item" *ngIf="location.state">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/>
              </svg>
              <span>{{ location.state }}</span>
            </div>
            <div class="detail-item" *ngIf="location.postalCode">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.5 12H16l-2.5 3.5L11 12H2"/>
                <path d="M5.5 5.5 11 12M18.5 5.5 13 12"/>
              </svg>
              <span>{{ location.postalCode }}</span>
            </div>
          </div>

          <p class="location-description" *ngIf="location.description">
            {{ location.description }}
          </p>
        </div>

        <div class="location-actions">
          <button class="btn-icon" (click)="startEditing(location)" title="Editar">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
            </svg>
          </button>
          <button class="btn-icon btn-danger" (click)="confirmDelete(location.id)" title="Eliminar">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Dialog -->
  <div class="modal-overlay" *ngIf="showDeleteConfirm()" (click)="cancelDelete()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirmar Eliminación</h3>
        <button class="btn-close" (click)="cancelDelete()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p>¿Estás seguro de que deseas eliminar esta ubicación?</p>
        <p class="warning-text">Esta acción no se puede deshacer.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="cancelDelete()">
          Cancelar
        </button>
        <button class="btn btn-danger" (click)="deleteLocation()">
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>
